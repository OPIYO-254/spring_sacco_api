<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sojrel Sacco Ltd</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <script src="main.js" type="text/javascript"></script>
    <link href="https://fonts.cdnfonts.com/css/poppins" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</head>
<body>
    <div th:insert="~{base :: navbar}"></div>
    <div class="container-fluid">
        <div class="row reg-main">
            <div th:insert="~{base :: sidebar}" class="sidebar-container col-md-3 col-lg-2 p-0" id="sidebar-container"></div>
            <div class="col-md-10 main-section">
                <span id="results"></span>
                <div style="height:60px;"></div>
                <div class="container-fluid pt-2 mt-2 mb-3 reg-form-container">
                    <div class="reg-container">
                        <div class="d-flex justify-content-center align-items-center py-1">
                            <h3 style="color:#09AA5C;">Member Registration</h3>
                        </div>
                        <form id="registration-form" method="post">
                            <hr>
                            <div class="row input-container">
                                <div class="col sub-container">
                                    <div class="mb-3">
                                        <label for="firstName" class="form-label">First Name:</label>
                                        <input type="text" class="form-control" id="firstName">
                                        <span id="fnameMsg"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="midName" class="form-label">Middle Name (optional):</label>
                                        <input type="text" class="form-control" id="midName">
                                        <span id="mnameMsg"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="lastName" class="form-label">Last Name:</label>
                                        <input type="text" class="form-control" id="lastName">
                                        <span id="lnameMsg"></span>

                                    </div>
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email:</label>
                                        <input type="email" class="form-control" id="email" aria-describedby="emailHelp">
                                        <span id="emailMsg"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="dob" class="form-label">Date of Birth:</label>
                                        <input type="date" class="form-control" id="dob">
                                        <span id="dobMsg"></span>

                                    </div>
                                    <div class="mb-3">
                                        <label for="idNo" class="form-label">ID Number:</label>
                                        <input type="number" class="form-control" id="idNo">
                                        <span id="idNoMsg"></span>
                                    </div>

                                </div>
                                <div class="col sub-container">
                                    <div class="mb-3">
                                        <label for="kraPin" class="form-label">Kra Pin:</label>
                                        <input type="text" class="form-control" id="kraPin">
                                        <span id="kraPinMsg"></span>

                                    </div>
                                    <div class="mb-3">
                                        <label for="phone" class="form-label">Phone Number:</label>
                                        <input type="text" class="form-control" id="phone">
                                        <span id="phoneMsg"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="phone1" class="form-label">Alternative Contact:</label>
                                        <input type="text" class="form-control" id="phone1">
                                        <span id="phone1Msg"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="gender" class="form-label">Gender</label>
                                        <select id="gender" class="form-control">
                                            <option align="center" value="">Select Gender</option>
                                            <option value="MALE">MALE</option>
                                            <option value="FEMALE">FEMALE</option>
                                        </select>
                                        <span id="genderMsg"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="address" class="form-label">Postal Address:</label>
                                        <input type="text" class="form-control" id="address">
                                        <span id="addressMsg"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="residence" class="form-label">Residence:</label>
                                        <input type="text" class="form-control" id="residence">
                                        <span id="residenceMsg"></span>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-center">
                                <button type="submit" id="submitBtn" style="width:auto; margin-bottom:24px;" class="btn submitBtn">Submit</button>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!--    <div th:insert="~{base :: footer}">  </div>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script>
        //function for registration of members
        $(document).ready(function () {
            $("#registration-form").submit(function (event) {
                event.preventDefault();
                if($("#firstName").val()==""){
                    $("#fnameMsg").html('<p style="font-size:12px; color:red;">Enter first name</p>');

                }
                else if($("#lastName").val()==""){
                    $("#lnameMsg").html('<p style="font-size:12px; color:red;">Enter last name</p>');

                }
                else if($("#email").val()==""){
                    $("#emailMsg").html('<p style="font-size:12px; color:red;">Enter email</p>');

                }
                else if($("#dob").val()==""){
                    $("#dobMsg").html('<p style="font-size:12px; color:red;">Enter date of birth</p>');

                }
                else if($("#idNo").val()==""||$("#idNo").val()==null || $("#idNo").val()==0){
                    $("#idNoMsg").html('<p style="font-size:12px; color:red;">Enter ID No.</p>');

                }
                else if($("#kraPin").val()==""){
                    $("#kraPinMsg").html('<p style="font-size:12px; color:red;">Enter KRA PIN</p>');

                }
                else if($("#phone").val()==""){
                    $("#phoneMsg").html('<p style="font-size:12px; color:red;">Enter phone number</p>');

                }
                else if($("#gender").val()=="" || $("#gender").val()==null){
                    $("#genderMsg").html('<p style="font-size:12px; color:red;">Select gender</p>');

                }
                else if($("#address").val()==""){
                    $("#addressMsg").html('<p style="font-size:12px; color:red;">Enter address</p>');

                }
                else if($("#residence").val()==""){
                    $("#residenceMsg").html('<p style="font-size:12px; color:red;">Enter residence</p>');

                }
                else{
                   var originalButtonText = $("#submitBtn").html();
                   $("#submitBtn").html('<div class="spinner-border" role="status" id="spinner">' +
                                      '<span class="visually-hidden"></span>' +
                                      '</div> Please wait...');

                   var formData = {
                        firstName: $("#firstName").val(),
                        midName: $("#midName").val(),
                        lastName: $("#lastName").val(),
                        email: $("#email").val(),
                        dob: $("#dob").val(),
                        idNo: $("#idNo").val(),
                        kraPin: $("#kraPin").val(),
                        phone: $("#phone").val(),
                        alternativePhone: $("#phone1").val(),
                        gender: $("#gender").val(),
                        address: $("#address").val(),
                        residence: $("#residence").val(),
                   }
                    console.log(formData);
                    $.ajax({
                        contentType : "application/json",
                        dataType : 'json',
                        type: "POST",
                        url: "/register-member",
                        data: JSON.stringify(formData),
                        success: function (response) {
                            if(response.status=="success"){
                                $("#submitBtn").html(originalButtonText);
                                $("#results").html('<div style="background-color:#7FA7B0; color:white;padding:12px 0px; text-align:center; width:100%;margin;0;"><p>'+response.message+'</p></div>');
                                $("#results").fadeToggle(3000);
                                $("#registration-form")[0].reset();

                            }
                            else{
                                $("#submitBtn").html(originalButtonText);
                                $("#results").html('<div style="background-color:#7FA7B0; color:white;padding:12px 0px; text-align:center; width:100%;"><p>'+response.message+'</p></div>');
                                $("#results").fadeToggle(3000);
                                $("#registration-form")[0].reset();

                            }
                        },
                        error: function (error) {
                            console.log("Error:", error);
                            $("#submitBtn").html(originalButtonText);
                            $("#results").html('<div style="background-color:#7FA7B0; color:white;padding:12px 0px; text-align:center; width:100%;"><p>Error!</p></div>');
                            $("#results").fadeToggle(3000);
                            $("#registration-form")[0].reset();
                        }
                    });

                }
            });
        });


    </script>
</body>
</html>
