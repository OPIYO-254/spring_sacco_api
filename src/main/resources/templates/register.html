<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sojrel Sacco Ltd</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <script src="main.js" type="text/javascript"></script>
    <link href="https://fonts.cdnfonts.com/css/poppins" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <div th:insert="~{base :: navbar}"></div>
    <div class="container-fluid">
        <div class="row reg-main">
            <div th:insert="~{base :: sidebar}" class="sidebar-container col-md-3 col-lg-2 p-0" id="sidebar-container"></div>
<!--            main section-->
            <div class="col-md-10 main-section">
                <span id="results"></span>
                <div class="page-title d-flex justify-content-center align-items-center p-2 m-4">
                    <span class="text-light">Member Registration</span>
                </div>
                <div class="container-fluid pt-lg-2 mt-lg-2">
                    <form id="registration-form" method="post" class="pt-1 mt-1 pb-4 mb-5">
                        <div class="d-flex flex-column flex-lg-row flex-md-column align-items-center px-lg-5 px-xl-7 column-container">
                            <div class="col-12 col-md-6 px-1 input-row px-3 mt-lg-4 mt-xlg-4">
                                <input type="text" id="firstName" placeholder="Enter First Name" class="form-control col-2 p-3 mb-4">
                                <input type="text" id="midName" placeholder="Enter Second Name" class="form-control col-2 p-3 mb-4">
                                <input type="text" id="lastName" placeholder="Enter Last Name" class="form-control col-2 p-3 mb-4">
                                <input type="email" id="email" placeholder="Enter Email" class="form-control col-2 p-3 mb-4">
                                <input type="date" id="dob" pattern="yyyy-MM-dd" placeholder="Date of Birth" class="form-control col-2 p-3 mb-4">
                                <input type="number" id="idNo" placeholder="Enter ID No." class="form-control col-2 p-3 mb-4">
                            </div>
                            <div class="col-12 col-md-6 px-1 input-row px-3 mb-4">
                                <input type="text" id="kraPin" placeholder="Enter KRA Pin" class="form-control col-2 p-3 mb-4">
                                <input type="text" id="phone" placeholder="Enter Phone Number" class="form-control col-2 p-3 mb-4">
                                <select id="gender" class="form-control col-2 p-3 mb-4" style="width: 100%">
                                    <option align="center" value="">----Select gender----</option>
                                    <option value="MALE">MALE</option>
                                    <option value="FEMALE">FEMALE</option>
                                </select>
                                <input type="text" id="address" placeholder="Enter Address"  class="form-control col-2 p-3 mb-4">
                                <input type="text" id="residence" placeholder="Enter Residence" class="form-control col-2 p-3 mb-4">
                                <button type="submit" id="submitBtn" class="btn btn-success p-3" style="width: 100%">SAVE</button>

                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
    <div th:insert="~{base :: footer}">  </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script>
        //function for registration of members
        $(document).ready(function () {
            $("#registration-form").submit(function (event) {
                event.preventDefault();
                if($("#firstName").val()==""){
                    alert("Enter first name");
                }
                else if($("#lastName").val()==""){
                    alert("Enter last name");
                }
                else if($("#email").val()==""){
                    alert("Enter email");
                }
                else if($("#dob").val()==""){
                    alert("Enter date of birth");
                }
                else if($("#idNo").val()==""||$("#idNo").val()==null || $("#idNo").val()==0){
                    alert("Enter ID No.");
                }
                else if($("#kraPin").val()==""){
                    alert("Enter KRA PIN");
                }
                else if($("#phone").val()==""){
                    alert("Enter phone number");
                }
                else if($("#gender").val()=="" || $("#gender").val()==null){
                    alert("Select gender");
                }
                else if($("#address").val()==""){
                    alert("Enter address");
                }
                else if($("#residence").val()==""){
                    alert("Enter residence");
                }
                else{
                   var originalButtonText = $("#submitBtn").html();
                   $("#submitBtn").html('<div class="spinner-border" role="status" id="spinner">' +
                                      '<span class="visually-hidden"></span>' +
                                      '</div> Please wait...');

                   var formData = {
                        firstName: $("#firstName").val(),
                        midName: $("#midName").val(),
                        lastName: $("#lastName").val(),
                        email: $("#email").val(),
                        dob: $("#dob").val(),
                        idNo: $("#idNo").val(),
                        kraPin: $("#kraPin").val(),
                        phone: $("#phone").val(),
                        gender: $("#gender").val(),
                        address: $("#address").val(),
                        residence: $("#residence").val(),
                   }
                    $.ajax({
                        contentType : "application/json",
                        dataType : 'json',
                        type: "POST",
                        url: "api/member/save-member",
                        data: JSON.stringify(formData),
                        success: function (response) {
                            if(response.status=="success"){
                                $("#submitBtn").html(originalButtonText);
                                $("#results").html('<div style="background-color:#7FA7B0; color:white;padding:20px 0px; text-align:center; width:100%;"><p>Member registered successfully</p></div>');
                                $("#results").fadeToggle(3000);
                                $("#registration-form")[0].reset();
                            }
                            else{
                                $("#submitBtn").html(originalButtonText);
                                $("#results").html('<div style="background-color:#7FA7B0; color:white;padding:20px 0px; text-align:center; width:100%;"><p>Failed!</p></div>');
                                $("#results").fadeToggle(3000);
                                $("#registration-form")[0].reset();

                            }
                        },
                        error: function (error) {
                            console.log("Error:", error);
                            $("#submitBtn").html(originalButtonText);
                            $("#results").html('<div style="background-color:#7FA7B0; color:white;padding:20px 0px; text-align:center; width:100%;"><p>Error!</p></div>');
                            $("#results").fadeToggle(3000);
                            $("#registration-form")[0].reset();
                        }
                    });

                }
            });
        });


    </script>
</body>
</html>
