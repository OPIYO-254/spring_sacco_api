<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sojrel Sacco Ltd</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <script src="main.js" type="text/javascript"></script>
    <link href="https://fonts.cdnfonts.com/css/poppins" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</head>
<body>
    <div th:insert="~{base :: navbar}"></div>
    <div class="container-fluid">
        <div class="row reg-main">
            <div th:insert="~{base :: sidebar}" class="sidebar-container col-md-3 col-lg-2 p-0" id="sidebar-container"></div>
            <div class="col-md-10 main-section">
                <span id="results"></span>
                <div class="page-title d-flex justify-content-center align-items-center pt-2 pb-2 mt-4 mx-2">
                    <span class="text-light">Member Registration</span>
                </div>
                <div class="container-fluid pt-2 mt-2 mb-3 reg-form-container">
                    <form id="registration-form" method="post">
                        <div class="row input-container">
                            <div class="col sub-container">
                                <div class="mb-3">
                                    <label for="firstName" class="form-label">First Name:</label>
                                    <input type="text" class="form-control" id="firstName">

                                </div>
                                <div class="mb-3">
                                    <label for="midName" class="form-label">Middle Name:</label>
                                    <input type="text" class="form-control" id="midName">
                                </div>
                                <div class="mb-3">
                                    <label for="lastName" class="form-label">Last Name:</label>
                                    <input type="text" class="form-control" id="lastName">

                                </div>
                                <div class="mb-3">
                                    <label for="email" class="form-label">Email:</label>
                                    <input type="email" class="form-control" id="email" aria-describedby="emailHelp">
                                </div>
                                <div class="mb-3">
                                    <label for="dob" class="form-label">Date of Birth:</label>
                                    <input type="date" class="form-control" id="dob">

                                </div>
                                <div class="mb-3">
                                    <label for="idNo" class="form-label">ID Number:</label>
                                    <input type="number" class="form-control" id="idNo">
                                </div>
                            </div>
                            <div class="col sub-container">
                                <div class="mb-3">
                                    <label for="kraPin" class="form-label">Kra Pin:</label>
                                    <input type="text" class="form-control" id="kraPin">

                                </div>
                                <div class="mb-3">
                                    <label for="phone" class="form-label">Phone Number:</label>
                                    <input type="text" class="form-control" id="phone">
                                </div>
                                <div class="mb-3">
                                    <label for="gender" class="form-label">Gender</label>
                                    <select id="gender" class="form-control">
                                        <option align="center" value="">Select Gender</option>
                                        <option value="MALE">MALE</option>
                                        <option value="FEMALE">FEMALE</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="address" class="form-label">Address:</label>
                                    <input type="text" class="form-control" id="address">
                                </div>
                                <div class="mb-3">
                                    <label for="residence" class="form-label">Residence:</label>
                                    <input type="email" class="form-control" id="residence">
                                </div>
                                <div class="mb-3">
                                    <!--                                    <label for="exampleInputPassword1" class="form-label">Password</label>-->
                                    <!--                                <input type="password" class="form-control" id="exampleInputPassword1">-->
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn submitBtn">Submit</button>

                    </form>
                </div>
            </div>
        </div>
    </div>
<!--    <div th:insert="~{base :: footer}">  </div>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script>
        //function for registration of members
        $(document).ready(function () {
            $("#registration-form").submit(function (event) {
                event.preventDefault();
                if($("#firstName").val()==""){
                    alert("Enter first name");
                }
                else if($("#lastName").val()==""){
                    alert("Enter last name");
                }
                else if($("#email").val()==""){
                    alert("Enter email");
                }
                else if($("#dob").val()==""){
                    alert("Enter date of birth");
                }
                else if($("#idNo").val()==""||$("#idNo").val()==null || $("#idNo").val()==0){
                    alert("Enter ID No.");
                }
                else if($("#kraPin").val()==""){
                    alert("Enter KRA PIN");
                }
                else if($("#phone").val()==""){
                    alert("Enter phone number");
                }
                else if($("#gender").val()=="" || $("#gender").val()==null){
                    alert("Select gender");
                }
                else if($("#address").val()==""){
                    alert("Enter address");
                }
                else if($("#residence").val()==""){
                    alert("Enter residence");
                }
                else{
                   var originalButtonText = $("#submitBtn").html();
                   $("#submitBtn").html('<div class="spinner-border" role="status" id="spinner">' +
                                      '<span class="visually-hidden"></span>' +
                                      '</div> Please wait...');

                   var formData = {
                        firstName: $("#firstName").val(),
                        midName: $("#midName").val(),
                        lastName: $("#lastName").val(),
                        email: $("#email").val(),
                        dob: $("#dob").val(),
                        idNo: $("#idNo").val(),
                        kraPin: $("#kraPin").val(),
                        phone: $("#phone").val(),
                        gender: $("#gender").val(),
                        address: $("#address").val(),
                        residence: $("#residence").val(),
                   }
                    $.ajax({
                        contentType : "application/json",
                        dataType : 'json',
                        type: "POST",
                        url: "api/member/save-member",
                        data: JSON.stringify(formData),
                        success: function (response) {
                            if(response.status=="success"){
                                $("#submitBtn").html(originalButtonText);
                                $("#results").html('<div style="background-color:#7FA7B0; color:white;padding:20px 0px; text-align:center; width:100%;"><p>Member registered successfully</p></div>');
                                $("#results").fadeToggle(3000);
                                $("#registration-form")[0].reset();
                            }
                            else{
                                $("#submitBtn").html(originalButtonText);
                                $("#results").html('<div style="background-color:#7FA7B0; color:white;padding:20px 0px; text-align:center; width:100%;"><p>Failed!</p></div>');
                                $("#results").fadeToggle(3000);
                                $("#registration-form")[0].reset();

                            }
                        },
                        error: function (error) {
                            console.log("Error:", error);
                            $("#submitBtn").html(originalButtonText);
                            $("#results").html('<div style="background-color:#7FA7B0; color:white;padding:20px 0px; text-align:center; width:100%;"><p>Error!</p></div>');
                            $("#results").fadeToggle(3000);
                            $("#registration-form")[0].reset();
                        }
                    });

                }
            });
        });


    </script>
</body>
</html>
