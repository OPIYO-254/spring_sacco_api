<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Sojrel Sacco Ltd</title>
    <link href="https://cdn.datatables.net/v/bs5/jq-3.7.0/dt-1.13.6/datatables.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.cdnfonts.com/css/poppins" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs5/jq-3.7.0/dt-1.13.6/datatables.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>

</head>
<body>
<div th:insert="~{base :: navbar}">  </div>
<div class="container-fluid">
    <div class="row">
        <div th:insert="~{base :: sidebar}" class="sidebar-container col-md-2 col-lg-2 p-0" id="sidebar-container"></div>
        <!-- Main Section -->
        <div class="col-md-10 main-section">
<!--            <div class="page-title d-flex justify-content-center align-items-center pt-3 pb-3 mt-3 mb-2 mx-2">-->
<!--                <span class="text-light fw-bold">Revenue</span>-->
<!--            </div>-->
            <div class="mycards-section">
                <div class="myrow">
                    <div class="item">
                        <div class="col">
                            <span class="card-text text-light m-0">Total Disbursed</span>
                            <span class="card-text text-light m-0" th:text="'KES ' +${totalDisbursed}"></span>
                        </div>
                        <div class="item-icon">
                            <i class="fa fa-plus-circle" aria-hidden="true"></i>
                        </div>
                    </div>
                    <div class="item">
                        <div class="col">
                            <span class="card-text text-light m-0">Total Amount</span>
                            <span class="card-text text-light m-0" th:text="'KES '+${totalAmount}"></span>
                        </div>
                        <div class="item-icon">
                            <i class="fa fa-calculator" aria-hidden="true"></i>
                        </div>

                    </div>
                    <div class="item">
                        <div class="col">
                            <span class="card-text text-light m-0">Expected Revenue</span>
                            <span class="card-text text-light m-0" th:text="'KES '+(${totalAmount}-${totalDisbursed})"></span>
                        </div>
                        <div class="item-icon">
                            <i class="fa fa-percent" aria-hidden="true"></i>
                        </div>

                    </div>
                    <div class="item">
                        <div class="col">
                            <span class="card-text text-light m-0">Completed</span>
                            <span class="card-text text-light m-0" th:text="'KES '+${completed}"></span>
                        </div>
                        <div class="item-icon">
                            <i class="fa fa-sign-in" aria-hidden="true"></i>
                        </div>

                    </div>
                    <div class="item">
                        <div class="col">
                            <span class="card-text text-light m-0">Uncollected</span>
                            <span class="card-text text-light m-0" th:text="'KES '+ (${totalAmount}-${repaid})"></span>
                        </div>
                        <div class="item-icon">
                            <i class="fa fa-sign-out" aria-hidden="true"></i>
                        </div>

                    </div>
                </div>
<!--                <div class="myrow">-->
<!--                    -->
<!--                    <div class="item col">-->
<!--                        <span class="card-text text-light m-0">Monthly Disbursement</span>-->
<!--                        <span class="card-text text-light m-0" th:text="'KES '+${totalAmount}"></span>-->
<!--                    </div>-->
<!--                    <div class="item col">-->
<!--                        <span class="card-text text-light m-0">Annual Disbursement</span>-->
<!--                        <span class="card-text text-light m-0" th:text="${annualDisbursement}!=null?'KES '+${annualDisbursement}:'KES 0.00'"></span>-->
<!--                    </div>-->
<!--                    <div class="item col">-->
<!--                        <span class="card-text text-light m-0">Monthly Collections</span>-->
<!--                        <span class="card-text text-light m-0" th:text="${monthlyDisburse}!=null?'KES '+${monthlyDisburse}:'KES 0.00'"></span>-->
<!--                    </div>-->
<!--                </div>-->
            </div>
            <div class="display_charts">
                <figure style="width:100%; height: 50vh;">
                    <div class="container-fluid mt-4 chart-area" id="chart-area">
                    </div>
                </figure>
                <div class="charts-row">
                    <div class="col" id="loan-categories">

                    </div>
                    <div class="col" id="in-out-chart">

                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<!--    <div class="dashboard-footer" th:insert="~{base :: footer}"></div>-->
<script src="main.js" type="text/javascript"></script>
<script type="text/javascript" th:inline="javascript">
    var chartData = [[${totalMonthly}]];
    //console.log(chartData);
    Highcharts.chart('chart-area', {
        chart: {
            type: 'column'
        },
        title: {
            text: 'Monthly Disbursement',
            style: {
                    fontSize: '14px'
                }
        },
        xAxis: {
            categories: chartData.map(function(item) {
                return item.key;
            })
        },
        yAxis: {
            title: {
                text: 'Total Disbursed',

            }
        },
        series: [{
            name: 'Total Monthly Disbursements',
            data: chartData.map(function(item) {
                return item.value;
            }),
            color: '#84d4ad'
        }]
    });

    //pie chart for loan categories
    var categoryData = [[${totalPerCategiry}]];
    var categories = categoryData.map(function(item) {
        return item.key;
    });

    var dataValues = categoryData.map(function(item) {
        return { name: item.key, y: item.value };
    });
    Highcharts.chart('loan-categories', {
        chart: {
            type: 'pie'
        },
        title: {
            text: 'Loan Products Share',
            style: {
                fontSize: '14px'
            }
        },
        series: [{
            name: 'Values',
            data: dataValues,
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f}%',
                style: {
                    fontSize: '10px'
                }
            }
        }]
    });


    //loans in and out
    var inOutData = [
        { key: 'Disbursements', value: (parseFloat([[${totalAmount}]])-parseFloat([[${repaid}]])) },
        { key: 'Collections', value: parseFloat([[${repaid}]]) },
    ]
    console.log([[${repaid}]]);
    var categories = inOutData.map(function(item) {
        return item.key;
    });

    var dataValues = inOutData.map(function(item) {
        return { name: item.key, y: item.value };
    });
    Highcharts.chart('in-out-chart', {
        chart: {
            type: 'pie'
        },
        title: {
            text: 'Disbursement Vs Collections',
            style: {
                fontSize: '14px' // Set the font size to 12px
            }
        },
        series: [{
            name: 'Values',
            data: dataValues,
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f}%',
                style: {
                    fontSize: '10px'
                }
            }
        }]
    });


</script>
</body>
</html>
