<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Please log into your account</title>
  <link href="https://cdn.datatables.net/v/bs5/jq-3.7.0/dt-1.13.6/datatables.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://fonts.cdnfonts.com/css/poppins" rel="stylesheet">
<!--  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="styles.css">
  <script src="main.js" type="text/javascript"></script>
</head>
<body>
<nav id="navbar" class="navbar navbar-expand-lg navbar-light">
  <div class="navbar-brand d-flex px-2">
    <img class="img bg-light" src="images/logo.png" alt="Logo" height="36px" style="border-radius: 18px;">
    <p class="text-light px-2">Sojrel Sacco</p>
  </div>
</nav>
<div class="container">
  <div class="create-account-container">
    <span class="m-0 p-0" id="results"></span>
    <div class="account-container">
      <div class="d-flex justify-content-center align-items-center">
        <h4 class="fw-bold" style="color: #09AA5C;">Login</h4>
      </div>
      <form id="signin-form" method="post" th:action="@{/login}">
        <div class="m-2">
          <div class="mb-3">
            <label for="email" class="form-label">Email:</label>
            <input type="email" class="form-control" id="email" name="username" required>
          </div>
          <div class="mb-3">
            <label for="pass" class="form-label">Password:</label>
            <input type="password" class="form-control" id="pass"  name="password" required>
          </div>
          <input type="submit" class="btn submitBtn mb-3" id="submitBtn">
          <div class="d-flex justify-content-between">
            <p>Don't have account?</p>
            <a th:href="@{/create-account}"><button type="button" class="forgot-btn">Signup</button></a>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<!--<div th:insert="~{base :: footer}">  </div>-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="crossorigin= "anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
<script>
/**
$(document).ready(function() {
    $("#signin-form").submit(function(event){
        event.preventDefault();
        // Define the URL for the login endpoint
        var loginUrl = "/api/auth/login";

        // Define the URL for the home page
        var homeUrl = "/home";

        // Set up the click event for the login button
        var email = $("#email").val();
        var password = $("#pass").val();

        // Create the login request
        var loginRequest = {
            email: email,
            password: password
        };

        // Send the login request to the server
        $.ajax({
            type: "POST",
            url: loginUrl,
            contentType: "application/json",
            data: JSON.stringify(loginRequest),
            success: function(data) {
                var jwtToken = data.token; // Retrieve the JWT token from the response
                //console.log(data.token);
                // Save the JWT token (e.g., in a cookie or local storage)
                localStorage.setItem("jwtToken", jwtToken);
                //$.cookie('token', data.token)
                loadHome(jwtToken);
                window.location.href=homeUrl;
            },
            error: function(error) {
                alert("Login failed. Please check your credentials.");
            }
        });
    });
});

function loadHome(jwtToken){
    $(document).ready(function() {
        // Define the URL for the home page
        var homeUrl = "/home";

        //Retrieve the JWT token (e.g., from local storage)
        //var jwtToken = localStorage.getItem("jwtToken"); // Make sure to adjust the storage method
        //console.log(jwtToken);
        // Check if the JWT token is available
        if (jwtToken) {
            $.ajax({
                type: "GET",
                url: homeUrl,
                headers: {
                    "Authorization": "Bearer " + jwtToken // Set the Authorization header
                },
                success: function(data) {
                  console.log('login')

                },
                error: function(error) {
                    alert("Authentication failed. Please log in.");
                }
            });
        } else {
            // Handle the case where the JWT token is not available or expired
            alert("JWT token not available. Please log in.");
        }
    });
}
**/
</script>
</body>
</html>